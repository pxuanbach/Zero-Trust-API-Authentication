routes:
  - uri: /api/v1/extension-app/*
    name: extension-app-route
    methods: ["GET", "POST", "PUT", "DELETE"]
    plugins:
      # Enable CORS for Client Browser
      cors:
        allow_origins: "*"
        allow_methods: "*"
        allow_headers: "*"
      
      request-id:
        include_in_response: true
      
      # JWT Authentication with Keycloak (AAA Server)
      openid-connect:
        client_id: "apisix-client"
        client_secret: "client-secret-placeholder"
        discovery: "http://keycloak:8080/realms/crm-tenant-1/.well-known/openid-configuration"
        bearer_only: true
        realm: "crm-tenant-1"
        token_signing_alg_values_expected: "RS256"
        
      # Rate Limiting
      limit-req:
        rate: 10
        burst: 5
        key: "consumer_name"
        rejected_code: 429
        
      # Proxy Rewrite
      proxy-rewrite:
        regex_uri: ["^/api/v1/extension-app/(.*)", "/$1"]
        
    upstream:
      nodes:
        "extension-app1:8000": 1
      type: roundrobin
      scheme: https
      # Configure mTLS Client (Gateway Cert) to authenticate with Service A
      tls:
        client_cert: "APISIX_CLIENT_CERT_CONTENT"
        client_key: "APISIX_CLIENT_KEY_CONTENT"
        verify: true # Verify Service A's Server Cert

#END
